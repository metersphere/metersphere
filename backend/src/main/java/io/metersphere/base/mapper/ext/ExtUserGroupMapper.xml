<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="io.metersphere.base.mapper.ext.ExtUserGroupMapper">


    <select id="getUserGroup" resultType="io.metersphere.dto.UserGroupDTO">
        select ug.user_id, ug.group_id, ug.source_id, g.`name`, g.type
        from user_group ug join `group` g on ug.group_id = g.id
        where ug.user_id = #{userId}
    </select>
    <select id="getOrganizationMemberGroups" resultType="io.metersphere.base.domain.Group">
        select g.id, g.name
        from organization o
                 join user_group ug on o.id = ug.source_id
                 join `group` g on g.id = ug.group_id
        where o.id = #{orgId} and ug.user_id = #{userId}
    </select>
    <select id="getOrgMemberList" resultType="io.metersphere.base.domain.User">
        SELECT DISTINCT * FROM (
        SELECT `user`.*
        FROM user_group JOIN `user`
        ON user_group.user_id = `user`.id
        WHERE user_group.source_id in
        (
        SELECT id FROM workspace w
        WHERE w.organization_id = #{orgMember.organizationId}
        UNION
        SELECT #{orgMember.organizationId} AS id FROM dual
        )
        <if test="orgMember.name != null">
            AND `user`.name like CONCAT('%', #{orgMember.name},'%')
        </if>
        order by user_group.update_time desc) temp
    </select>
    <select id="getWorkspaceMemberGroups" resultType="io.metersphere.base.domain.Group">
        select r.id, r.name
        from workspace w
                 join user_group ur on w.id = ur.source_id
                 join `group` r on r.id = ur.group_id
        where w.id = #{workspaceId} and ur.user_id = #{userId}
    </select>
    <select id="getMemberList" resultType="io.metersphere.base.domain.User">
        SELECT DISTINCT * FROM (
        SELECT `user`.* FROM user_group JOIN `user` ON user_group.user_id = `user`.id
        WHERE user_group.source_id = #{member.workspaceId}
        <if test="member.name != null">
            AND `user`.name like CONCAT('%', #{member.name},'%')
        </if>
        order by user_group.update_time desc) temp
    </select>
</mapper>
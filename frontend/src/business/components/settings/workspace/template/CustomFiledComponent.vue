<template>
  <span v-if="isActive">
     <el-select v-if="data.type === 'select' || data.type === 'multipleSelect'"
                :disabled="disabled"
                :multiple="data.type === 'multipleSelect'"
                @change="handleChange"
                filterable v-model="data[prop]" placeholder="默认值">
      <el-option
        v-for="(item,index) in data.options ? data.options : []"
        :key="index"
        @change="handleChange"
        :label="getTranslateOption(item)"
        :value="item.value">
      </el-option>
    </el-select>

    <el-input
      v-else-if="data.type === 'textarea'"
      type="textarea"
      @change="handleChange"
      :rows="2"
      :disabled="disabled"
      placeholder="请输入内容"
      class="custom-with"
      v-model="data[prop]">
    </el-input>

    <el-checkbox-group
      v-else-if="data.type === 'checkbox'"
      :disabled="disabled"
      v-model="data[prop]">
      <el-checkbox v-for="(item, index) in data.options ? data.options : []"
                   :key="index"
                   @change="handleChange"
                   :label="getTranslateOption(item)"></el-checkbox>
    </el-checkbox-group>

    <el-radio
      v-else-if="data.type === 'radio'"
      v-model="data[prop]"
      :disabled="disabled"
      v-for="(item,index) in data.options ? data.options : []"
      :key="index"
      @change="handleChange"
      :label="getTranslateOption(item)"></el-radio>

    <el-input-number
      v-else-if="data.type === 'int'"
      v-model="data[prop]"
      :disabled="disabled"
      @change="handleChange"
      label="描述文字"></el-input-number>

    <el-input-number
      v-else-if="data.type === 'float'"
      :disabled="disabled"
      @change="handleChange"
      v-model="data[prop]" :precision="2" :step="0.1"></el-input-number>

     <el-date-picker
       class="custom-with"
       @change="handleChange"
       v-else-if="data.type === 'data'"
       :disabled="disabled"
       v-model="data[prop]"
       type="date"
       placeholder="选择日期">
    </el-date-picker>

    <el-select v-else-if="data.type === 'member' || data.type === 'multipleMember'"
               :multiple="data.type === 'multipleMember'"
               @change="handleChange"
               :disabled="disabled"
               filterable v-model="data[prop]" placeholder="默认值">
       <el-option
         v-for="(item) in memberOptions"
         :key="item.id"
         :label="item.id + ' (' + item.name + ')'"
         :value="item.id">
       </el-option>
    </el-select>

    <el-input class="custom-with"
              @change="handleChange"
              :disabled="disabled"
              v-else v-model="data[prop]"/>

  </span>

</template>

<script>
import MsTableColumn from "@/business/components/common/components/table/Ms-table-column";
import {getCurrentWorkspaceId} from "@/common/js/utils";
export default {
  name: "CustomFiledComponent",
  components: {MsTableColumn},
  props: [
    'data',
    'prop',
    'form',
    'disabled'
  ],
  data() {
    return {
      memberOptions: [],
      isActive: false
    };
  },
  mounted() {
    if (this.data.type === 'member' || this.data.type === 'multipleMember') {
      this.$post('/user/ws/member/tester/list', {workspaceId: getCurrentWorkspaceId()}, response => {
        this.memberOptions = response.data;
      });
    }

    if (this.data.type === 'checkbox' || this.data.type === 'multipleSelect'
    || this.data.type === 'multipleMember') {
      this.data[this.prop] = [];
    } else if (this.data.type === 'float' || this.data.type === 'int') {
      this.data[this.prop] = null;
    } else {
      this.data[this.prop] = "";
    }
    this.isActive = true;
  },
  methods: {
    getTranslateOption(item) {
      return item.system ? this.$t(item.text) : item.text;
    },
    handleChange() {
      if (this.form) {
        this.$set(this.form, this.data.name, this.data[this.prop]);
        this.$emit('reload');
      }
    }
  }
};
</script>

<style scoped>
</style>
